process.env.NTBA_FIX_319 = 1

const TelegramBot = require('node-telegram-bot-api')
const SpamService = require('./services/SpamService')
const CallService = require('./services/CallService')
const validatePhone = require('./utils/validatePhone')

const token = '5383178738:AAFJbv76Nxkvakv6cvzWX52dlqKF4o1ojh8'
const bot = new TelegramBot(token, {polling: true})

const startOptions = {
	parse_mode: 'Markdown'
}

const defaultOptions = {
	parse_mode: 'Markdown',
	reply_markup: JSON.stringify({
		inline_keyboard: [
			[{text: '–ó–∞–∫–∞–∑–∞—Ç—å –∑–≤–æ–Ω–æ–∫ ‚òéÔ∏è', callback_data: 'call'}],
			[{text: '–ù–∞—á–∞—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É üí£', callback_data: 'bomb'}],
			[{text: '–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –∂–µ—Ä—Ç–≤—ã üìç', callback_data: 'location'}, {text: '–ö–æ–Ω—Ç–∞–∫—Ç—ã –∂–µ—Ä—Ç–≤—ã üìû', callback_data: 'contact'}],
			[{text: 'üçëüçÜ –ó–∞–¥–æ–Ω–∞—Ç–∏—Ç—å –Ω–∞ —Å—Ç—Ä–∏–Ω–≥–∏ –ê–Ω–¥—Ä–µ—é üíùüëô', callback_data: 'donate'}],
			[{text: '–ó–∞–ø–∏—Å–∞—Ç—å –Ω–∞ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –≥—Ä—É–¥–∏ üëô', callback_data: 'call2'}]
		]
	})
}

const go = async (chatId) => {
	await bot.sendMessage(chatId, '–ù–µ —Ö–æ—Ç–∏—Ç–µ –ª–∏ –ø–æ—É–Ω–∏–∂–∞—Ç—å?', defaultOptions)
}

const start = () => {
	bot.setMyCommands([
		{command: '/start', description: '–ó–∞–ø—É—Å–∫–∞–µ—Ç –±–æ—Ç–∞'},
		{command: '/menu', description: '–í—ã–∑—ã–≤–∞–µ—Ç –º–µ–Ω—é –±–æ—Ç–∞'}
	])

	bot.onText(/\/start/, async msg => {
		const chatId = msg.chat.id

		await bot.sendMessage(chatId, `–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ *—Ç–æ—Ç–∞–ª—å–Ω–æ–µ_—É–Ω–∏–∂–µ–Ω–∏–µ_–∞–Ω–¥—Ä—ç_bot*! –ú—ã —Ä–∞–¥—ã –≤–∏–¥–µ—Ç—å –≤–∞—Å, *${msg.from.first_name}*! \n–î—É–º–∞—é —É –≤–∞—Å –º–æ–≥ –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å –≤–æ–ø—Ä–æ—Å: –∑–∞—á–µ–º –∂–µ –º–Ω–µ —É–Ω–∏–∂–∞—Ç—å —ç—Ç–æ–≥–æ "–ê–Ω–¥—Ä—ç"? –í–æ–∑–º–æ–∂–Ω–æ –≤—ã –µ–≥–æ –¥–∞–∂–µ –Ω–µ –∑–Ω–∞–µ—Ç–µ. –ù–û! –ü—Ä–æ—á–∏—Ç–∞–π—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ. –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –≤–∞–º –≤—Å–µ —Å—Ç–∞–Ω–µ—Ç –ø–æ–Ω—è—Ç–Ω–æ...`, startOptions)
			.then(async () => {
				await bot.sendMessage(chatId, '–î—É–º–∞—é, –Ω–∞—á–∞—Ç—å —Å—Ç–æ–∏—Ç —Å –±–∏–æ–≥—Ä–∞—Ñ–∏–∏.')
			})
			.then(async () => {
				await bot.sendPhoto(chatId, './assets/andre.jpg', {
					caption: '–ü–∏–¥–æ—Ä'
				}, 2000)
				.then(async () => {
					await bot.sendMessage(chatId, '–§–µ–¥—É–ª–æ–≤ –ê–Ω–¥—Ä–µ–π –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–∏—á\n\n–†–æ–¥–∏–ª—Å—è –≤ –Ω–µ–±–æ–ª—å—à–æ–º –ø–æ—Å–µ–ª–∫–µ –≤ –ò–∂–µ–≤—Å–∫–µ. –ï–≥–æ —Ä–æ–¥–∏—Ç–µ–ª—è–º–∏ –±—ã–ª–∏ –º–æ–Ω–≥–æ–ª –∏ –∫–æ–±—ã–ª–∞. –û—Ç–µ—Ü –∑–∞–Ω–∏–º–∞–ª—Å—è –≥—Ä–∞–±–µ–∂–æ–º, —Ä–µ–¥–∫–æ –±—ã–≤–∞–ª –¥–æ–º–∞ –∏ –º–Ω–æ–≥–æ –ø–∏–ª. –ù–µ—Ä–µ–¥–∫–æ –¥–æ—Ö–æ–¥–∏–ª–æ –¥–æ –ø—å—è–Ω—ã—Ö –¥—Ä–∞–∫ —Å –º–∞–º–æ–π –∏–ª–∏ —Å—ã–Ω–æ–º. –ú–∞—Ç—å –∂–µ —Ä–∞–±–æ—Ç–∞–ª–∞ –Ω–∞ –ø–æ–ª–µ –Ω–µ–ø–æ–¥–æ–ª–µ–∫—É –∏ —Ç—è–≥–∞–ª–∞ —Ç–∞–º –ø–ª—É–≥.\n\n–ö–∞–∫ –≤—ã —É–∂–µ –º–æ–≥–ª–∏ –ø–æ–Ω—è—Ç—å - –¥–µ—Ç—Å—Ç–≤–æ –ê–Ω–¥—Ä—ç –±—ã–ª–æ –Ω–µ–ª–µ–≥–∫–∏–º, —á—Ç–æ –æ—á–µ–Ω—å —Å–∫–∞–∑–∞–ª–æ—Å—å –Ω–∞ –Ω–µ–º. –í –≤–æ–∑—Ä–∞—Å—Ç–µ 6 –ª–µ—Ç –æ–Ω —Ä–µ—à–∏–ª –ø–æ–¥–Ω—è—Ç—å –¥–µ–Ω–µ–≥ –Ω–∞ –ø—Ä–µ–≤–æ–º –ª–æ—Ö–æ—Ç—Ä–æ–Ω–µ. –¢–æ–≥–¥–∞ —ç—Ç–æ –±—ã–ª–æ –µ—â—ë –Ω–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–æ, –ø–æ—ç—Ç–æ–º—É –Ω–∏–∫—Ç–æ –Ω–µ –ø–æ–¥–æ–∑—Ä–µ–≤–≤–∞–ª –º–∞–ª–µ–Ω—å–∫–æ–≥–æ –º–∞–ª—å—á–∏–∫–∞ –≤ –æ–±–º–∞–Ω–µ. –°—É—Ç—å –ª–æ—Ö–æ—Ç—Ä–æ–Ω–∞ –∑–∞–∫–ª—é—á–∞–ª–∞—Å—å –≤ —Ç–æ–º, —á—Ç–æ –≤—ã –¥–æ–ª–∂–Ω—ã –±—ã–ª–∏ —Å–ª–æ–∂–∏—Ç—å –≤—Å–µ –¥—Ä–∞–≥–æ—Ü–µ–Ω–Ω–æ—Å—Ç–∏ –≤ —à–ª—è–ø—É, –∑–∞–∫—Ä—ã—Ç—å –≥–ª–∞–∑–∞, –∏ —á–µ—Ä–µ–∑ –ø—è—Ç–Ω–∞–¥—Ü–∞—Ç—å —Å–µ–∫—É–Ω–¥ –≤—Å–µ –∏—Å—á–µ–∑–∞–ª–æ. –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –ª—é–¥–µ–π —É—Ö–æ–¥–∏–ª–æ –¥–æ–≤–æ–ª—å–Ω—ã–º–∏, –Ω–æ –±—ã–ª–∏ –∏ —Ç–µ –∫—Ç–æ —Ö–æ—Ç–µ–ª –≤–µ—Ä–Ω—É—Ç—å –¥—Ä–∞–≥–æ—Ü–µ–Ω–Ω–æ—Å—Ç–∏, –æ–¥–Ω–∞–∫–æ –ø—Ä–æ–Ω—ã—Ä–ª–∏–≤—ã–π —Å—É—á–∏–π –ø–æ—Ç—Ä–æ—Ö –¥–∞–≤–∞–ª –∏–º –ª–∏—à—å –ø–∏–Ω–∫–∞ –ø–æ —è–π—Ü–∞–º –∏ —Ö–æ—Ä–æ—à–µ–Ω—å–∫–æ –ø–æ–∫—Ä—ã–≤–∞–ª –º–∞—Ç–æ–º... –í–æ–∑–º–æ–∂–Ω–æ –≤–∞–º —Å—Ç–∞–ª–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ, –∫–∞–∫ –∂–µ –æ–Ω –ø—Ä–æ–≤–æ—Ä–∞—á–∏–≤–∞–ª —ç—Ç–æ—Ç —Ç—Ä—é–∫? –ß—Ç–æ –∂, —Ç—É—Ç –≤—Å–µ –æ—á–µ–Ω—å –ø—Ä–æ—Å—Ç–æ - —Å–µ–∫—Ä–µ—Ç –∑–∞–∫–ª—é—á–∞–ª—Å—è –≤ –¥–≤–æ–π–Ω–æ–º –¥–Ω–µ —à–ª—è–ø—ã. –û–Ω –ø—Ä—è—Ç–∞–ª –≤—Å–µ —Ç—É–¥–∞, –∞ –∫–æ–≥–¥–∞ –µ–º–∫–æ—Å—Ç—å –∑–∞–ø–æ–ª–Ω—è–ª–∞—Å—å –ø–µ—Ä–µ–∫–ª–∞–¥—ã–≤–∞–ª –≤—Å–µ –≤ —Å—É–Ω–¥—É–∫. –î—É–º–∞—é —É–∂–µ —Ç–æ–≥–¥–∞ –±—É–¥—É—â–µ–µ –º–∞–ª—å—á–∏–∫–æ –±—ã–ª–æ –ø–æ–Ω—è—Ç–Ω–æ...\n\n–ó–∞—Ç–µ–º, –≤ –≤–æ–∑—Ä–∞—Å—Ç–µ 14 –ª–µ—Ç –æ–Ω –Ω–∞—á–∞–ª —É–≤–ª–µ–∫–∞—Ç—å—Å—è –∂–µ–Ω—â–∏–Ω–∞–º–∏. –í—Å–µ –Ω–∞—á–∞–ª–æ—Å—å —Å –Ω–µ–≤–∏–Ω–Ω–æ–≥–æ –¥–∏–∫–ø–∏–∫–∞ –æ–¥–Ω–æ–∫–ª–∞—Å—Å–Ω–∏—Ü–µ. –ü–æ—Ç–æ–º –æ–Ω –Ω–∞—á–∞–ª –∫ –Ω–µ–π –ø—Ä–∏—Å—Ç–∞–≤–∞—Ç—å. –û –¥–∞–ª—å–Ω–µ–π—à–∏—Ö –¥–µ–π—Ç–≤–∏—è—Ö –∏—Å—Ç–æ—Ä–∏—è —É–º–∞–ª—á–∏–≤–∞–µ—Ç, –æ–¥–Ω–∞–∫–æ —Ö–æ–¥—è—Ç —Å–ª—É—Ö–∏, —á—Ç–æ –Ω–∞ —ç—Ç–æ–º –¥–µ–ª–æ –Ω–µ –∑–∞–∫–æ–Ω—á–∏–ª–æ—Å—å... –ó–∞—Ç–µ–º –æ–Ω –æ—Ç–∫—Ä—ã–ª –±–æ—Ä–¥–µ–ª—å –≤ —Ü–µ–Ω—Ç—Ä–µ –ø–∏—Ç–µ—Ä–∞.\n\n–í –≤–æ–∑—Ä–∞—Å—Ç–µ 15 –ª–µ—Ç –æ–Ω –Ω–∞—á–∞–ª –∞–∫—Ç–∏–≤–Ω–æ —É–≤–ª–µ–∫–∞—Ç—å—Å—è –≥–æ–º–æ—Å–µ–∫—Å—É–∞–ª–∏–∑–º–æ–º. –û—Ç–∫—Ä—ã–ª –≥–µ–π –∫–ª—É–± "–†–æ–º–∞—à–∫–∞" –∏ —Å –≥–æ–ª–æ–≤–æ–π —É—à–µ–ª –≤ —ç—Ç–∏ –∑–∞–Ω—è—Ç–∏—è. –í—Å–µ –µ–≥–æ –≥—Ä–µ—Ö–∏ –º–æ–∂–Ω–æ –ø–µ—Ä–µ—á–∏—Å–ª—è—Ç—å –µ—â–µ –¥–æ–ª–≥–æ, –Ω–æ –µ—Å—Ç—å –µ—â–µ –æ–¥–∏–Ω, –∫–æ—Ç–æ—Ä—ã–º –æ–Ω –æ—Å–æ–±–µ–Ω–Ω–æ –æ—Ç–ª–∏—á–∏–ª—Å—è. –ü–æ—Å–ª–µ –≤—Ç–æ—Ä–∂–µ–Ω–∏—è –Ω–∞ –£–∫—Ä–∞–∏–Ω—É —Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö –≤–æ–π—Å–∫ –æ–Ω –Ω–∞—á–∞–ª –∞–∫—Ç–∏–≤–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –ø—É—Ç–∏–Ω–∞ –∏ —Å–º–µ—Ä—Ç–æ—É–±–∏–π—Å—Ç–≤–∞. –ê –∫–æ–≥–¥–∞ –µ–≥–æ –ø—ã—Ç–∞–ª–∏—Å—å –ø–µ—Ä–µ—É–±–µ–¥–∏—Ç—å, –æ–Ω –≥–æ–≤–æ—Ä–∏–ª, —á—Ç–æ –µ–≥–æ –Ω–∏–∫—Ç–æ –Ω–µ –ø–æ–Ω–∏–º–∞–µ—Ç, –Ω–æ –≤ –±—É–¥—É—â–µ–º –æ–Ω –æ–∫–∞–∂–µ—Ç—Å—è –ø—Ä–∞–≤... –ü–∏–¥–æ—Ä –æ–Ω –∫–æ—Ä–æ—á.\n\n–î—É–º–∞—é —Ç–µ–ø–µ—Ä—å –≤–∞–º –ø–æ–Ω—è—Ç–Ω–æ –ø–æ—á–µ–º—É –≤—ã –ø—Ä–æ—Å—Ç–æ –æ–±—è–∑–∞–Ω—ã –µ–≥–æ —É–Ω–∏–∑–∏—Ç—å...')
				}).then(async () => {
					await go(chatId)
				})
			})
	})

	bot.onText(/\/bomb/, async msg => {
		const chatId = msg.chat.id

		if (!SpamService.isActive) {
			await bot.sendMessage(chatId, `–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –±–µ–∑ –∑–Ω–∞–∫–æ–≤ —Å–∫–æ–±–æ–∫, –ø—Ä–æ–±–µ–ª–æ–≤, —Ç–∏—Ä–µ –∏ –¥—Ä—É–≥–∏—Ö –ª–∏—à–Ω–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤. \n–ü—Ä–∏–º–µ—Ä: +79998887766, 87779996655, 78889997766`)

			bot.onText(/^((\+7|7|8)+([0-9]){10})$/, async msg => {
				const id = msg.chat.id
				const phone = validatePhone(msg.text)

				SpamService.setIsActive = true
				await bot.sendMessage(id, '–†–∞—Å—Å—ã–ª–∫–∞ –Ω–∞—á–∞–ª–∞—Å—å! –ù–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π –≤–∞–º–∏ –Ω–æ–º–µ—Ä –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ 50 —Å–æ–æ–±—â–µ–Ω–∏–π!')

				SpamService
					.bomb(phone)
					.then(async () => {
						SpamService.setIsActive = false
						await bot.sendMessage(id, '–†–∞—Å—Å—ã–ª–∫–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!')
					})
					.catch(async (err) => {
						await bot.sendMessage(chatId, '–£–ø—Å. –í–æ –≤—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –ø—Ä–æ–∏–∑–æ—à–ª–∞ –∫–∞–∫–∞—è-—Ç–æ –æ—à–∏–±–∫–∞!')
						console.log(err)
					})
			})
		} else {
			await bot.sendMessage(chatId, '–†–∞—Å—Å—ã–ª–∫–∞ —É–∂–µ –∑–∞–ø—É—â–µ–Ω–∞! –≤—ã –º–æ–∂–µ—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —Ç–æ–ª—å–∫–æ –æ–¥–Ω—É —Ä–∞—Å—Å—ã–ª–∫—É!')
		}
	})

	bot.onText(/\/menu/, async msg => {
		const chatId = msg.chat.id

		go(chatId)
	})

	bot.on('callback_query', async msg => {
		const chatId = msg.message.chat.id
		const data = msg.data

		if (data === 'call') {
			await CallService
				.call()
				.then(() => {
					bot.sendMessage(chatId, '–ó–∞—è–≤–∫–∞ –Ω–∞ –∑–≤–æ–Ω–æ–∫ –¥–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –º–∏–∫—Ä–æ–∑–∞–π–º–∞ –Ω–∞ 10 —Ç—ã—Å—è—á —Ä—É–±–ª–µ–π –¥–ª—è –±–∏–∑–Ω–µ—Å–∞ –ê–Ω–¥—Ä–µ—è —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!')
				})
				.catch(err => {
					console.log(err)
					bot.sendMessage(chatId, '–£–ø—Å! –í–æ –≤—Ä–µ–º—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –º–∏–∫—Ä–æ–∑–∞–π–º–∞ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –∫–∞–∫–∞—è-—Ç–æ –æ—à–∏–±–∫–∞!')
				})
		} else if (data === 'bomb') {
			await SpamService
				.bomb()
				.then(() => {
					bot.sendMessage(chatId, '–†–∞—Å—Å—ã–ª–∫–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∞')
				})
				.catch(err => {
					console.log(err)
					bot.sendMessage(chatId, '–£–ø—Å! –í–æ –≤—Ä–µ–º—è —Ä–∞—Å—Å—ã–ª–∫–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –∫–∞–∫–∞—è-—Ç–æ –æ—à–∏–±–∫–∞!')
				})
		} else if (data === 'call2') {
			await CallService
				.call2()
				.then(async () => {
					bot.sendMessage(chatId, '–ó–∞–ø–∏—Å—å –Ω–∞ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –≥—Ä—É–¥–∏ —É—Å–ø–µ—à–Ω–æ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∞!')
				})
				.catch(err => {
					console.log(err)
					bot.sendMessage(chatId, '–£–ø—Å! –í–æ –≤—Ä–µ–º—è –∑–∞–ø–∏—Å–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –∫–∞–∫–∞—è-—Ç–æ –æ—à–∏–±–∫–∞!')
				})
		} else if (data === 'location') {
			await bot.sendLocation(chatId, 59.938435, 30.277674)
			await bot.sendMessage(chatId, '–ö–≤–∞—Ä—Ç–∏—Ä–∞ 20')
		} else if (data === 'contact') {
			await bot.sendContact(chatId, '+79811641799', '–ê–Ω–¥—Ä–µ–π –§–µ–¥—É–ª–æ–≤')
		}
	})
}

start()
